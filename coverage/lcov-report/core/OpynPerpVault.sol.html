<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for core/OpynPerpVault.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">core/</a> OpynPerpVault.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/92</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/30</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/27</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/94</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity &gt;=0.7.2;
pragma experimental ABIEncoderV2;
&nbsp;
import '@openzeppelin/contracts-upgradeable/utils/ReentrancyGuardUpgradeable.sol';
import '@openzeppelin/contracts-upgradeable/token/ERC20/ERC20Upgradeable.sol';
import '@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol';
import { IAction } from '../interfaces/IAction.sol';
import { IERC20 } from '@openzeppelin/contracts/token/ERC20/IERC20.sol';
import { IWETH } from '../interfaces/IWETH.sol';
import { SafeERC20 } from '@openzeppelin/contracts/token/ERC20/SafeERC20.sol';
import { SafeMath } from '@openzeppelin/contracts/math/SafeMath.sol';
&nbsp;
contract OpynPerpVault is ERC20Upgradeable, ReentrancyGuardUpgradeable, OwnableUpgradeable {
  using SafeMath for uint256;
  using SafeERC20 for IERC20;
&nbsp;
  enum VaultState {
    Locked,
    Unlocked,
    Emergency
  }
&nbsp;
  VaultState public state;
&nbsp;
  uint256 public constant BASE = 10000; // 100%
&nbsp;
  /// @dev how many percentage should be reserved in vault for withdraw. 1000 being 10%
  uint256 public withdrawReserve;
&nbsp;
  address public WETH;
&nbsp;
  address public asset;
&nbsp;
  address public feeRecipient;
&nbsp;
  /// @dev actions that build up this strategy (vault)
  address[] public actions;
&nbsp;
  /// @dev Cap for the vault. hardcoded at 1000 for initial release
  uint256 constant public CAP = 1000 ether;
&nbsp;
  /*=====================
   *       Events       *
   *====================*/
&nbsp;
  event Deposit(address account, uint256 amountDeposited, uint256 shareMinted);
&nbsp;
  event Withdraw(address account, uint256 amountWithdrawn, uint256 fee, uint256 shareBurned);
&nbsp;
  event Rollover(uint256[] allocations);
&nbsp;
  event StateUpdated(VaultState state);
&nbsp;
  /*=====================
   *     Modifiers      *
   *====================*/
  
  /**
   * @dev can only be executed and unlock state. which bring the state back to "locked"
   */
<span class="fstat-no" title="function not covered" >  modifier locker {</span>
<span class="cstat-no" title="statement not covered" >    require(state == VaultState.Unlocked, "!Unlocked")</span>;
    _;
<span class="cstat-no" title="statement not covered" >    state = VaultState.Locked</span>;
<span class="cstat-no" title="statement not covered" >    emit StateUpdated(VaultState.Locked);</span>
  }
&nbsp;
  /**
   * @dev can only be executed in locked state. which bring the state back to "unlocked"
   */
<span class="fstat-no" title="function not covered" >  modifier unlocker {</span>
<span class="cstat-no" title="statement not covered" >    require(state == VaultState.Locked, "!Locked")</span>;
    _;
&nbsp;
<span class="cstat-no" title="statement not covered" >    state = VaultState.Unlocked</span>;
<span class="cstat-no" title="statement not covered" >    emit StateUpdated(VaultState.Unlocked);</span>
  }
&nbsp;
  /**
   * @dev can only be executed if vault is not in emergency state.
   */
<span class="fstat-no" title="function not covered" >  modifier notEmergency {</span>
<span class="cstat-no" title="statement not covered" >    require(state != VaultState.Emergency, "Emergency")</span>;
    _;
  }
&nbsp;
  /*=====================
   * external function *
   *====================*/
&nbsp;
  /**
   * @dev init the vault.
   * this will set the "action" for this strategy vault and won't be able to change
   */
<span class="fstat-no" title="function not covered" >  function init(</span>
    address _asset,
    address _owner,
    address _feeRecipient,
    address _weth,
    uint8 _decimals,
    string memory _tokenName,
    string memory _tokenSymbol,
    address[] memory _actions
  ) public initializer {
<span class="cstat-no" title="statement not covered" >    __ReentrancyGuard_init()</span>;
<span class="cstat-no" title="statement not covered" >    __ERC20_init(_tokenName, _tokenSymbol)</span>;
<span class="cstat-no" title="statement not covered" >    _setupDecimals(_decimals)</span>;
<span class="cstat-no" title="statement not covered" >    __Ownable_init()</span>;
<span class="cstat-no" title="statement not covered" >    transferOwnership(_owner)</span>;    
&nbsp;
<span class="cstat-no" title="statement not covered" >    asset = _asset</span>;
<span class="cstat-no" title="statement not covered" >    feeRecipient = _feeRecipient</span>;
<span class="cstat-no" title="statement not covered" >    WETH = _weth</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >    actions = _actions</span>;
<span class="cstat-no" title="statement not covered" >    state = VaultState.Unlocked</span>;
  }
&nbsp;
  /**
   * total assets controlled by this vault
   */
<span class="fstat-no" title="function not covered" >  function totalAsset() external view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >    return _totalAsset();</span>
  }
&nbsp;
  /**
   * @dev return how many shares you can get if you deposit asset into the pool
   * @param _amount amount of asset you deposit
   */
<span class="fstat-no" title="function not covered" >  function getSharesByDepositAmount(uint256 _amount) external view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >    return _getSharesByDepositAmount(_amount, _totalAsset());</span>
  }
&nbsp;
  /**
   * @dev return how many asset you can get if you burn the number of shares, after charging the fee.
   */
<span class="fstat-no" title="function not covered" >  function getWithdrawAmountByShares(uint256 _shares) external view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >    uint256 withdrawAmount = _getWithdrawAmountByShares(_shares);</span>
<span class="cstat-no" title="statement not covered" >    uint256 fee = _getWithdrawFee(withdrawAmount);</span>
<span class="cstat-no" title="statement not covered" >    return withdrawAmount.sub(fee);</span>
  }
&nbsp;
  /**
   * @notice Deposits ETH into the contract and mint vault shares. Reverts if the underlying is not WETH.
   */
<span class="fstat-no" title="function not covered" >  function depositETH() external payable nonReentrant notEmergency{</span>
<span class="cstat-no" title="statement not covered" >    require(asset == WETH, '!WETH')</span>;
<span class="cstat-no" title="statement not covered" >    require(msg.value &gt; 0, '!VALUE')</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >    IWETH(WETH).deposit{ value: msg.value }()</span>;
<span class="cstat-no" title="statement not covered" >    _deposit(msg.value)</span>;
  }
&nbsp;
  /**
   * @dev deposit ERC20 asset and get shares
   */
<span class="fstat-no" title="function not covered" >  function deposit(uint256 _amount) external notEmergency {</span>
<span class="cstat-no" title="statement not covered" >    IERC20(asset).safeTransferFrom(msg.sender, address(this), _amount)</span>;
<span class="cstat-no" title="statement not covered" >    _deposit(_amount)</span>;
  }
&nbsp;
  /**
   * @notice Withdraws ETH from vault using vault shares
   * @param share is the number of vault shares to be burned
   */
<span class="fstat-no" title="function not covered" >  function withdrawETH(uint256 share) external nonReentrant notEmergency {</span>
<span class="cstat-no" title="statement not covered" >    require(asset == WETH, '!WETH')</span>;
<span class="cstat-no" title="statement not covered" >    uint256 withdrawAmount = _withdraw(share);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    IWETH(WETH).withdraw(withdrawAmount)</span>;
<span class="cstat-no" title="statement not covered" >    (bool success, ) = msg.sender.call{ value: withdrawAmount }('');</span>
<span class="cstat-no" title="statement not covered" >    require(success, 'ETH transfer failed')</span>;
  }
&nbsp;
  /**
   * @notice Withdraws asset from vault using vault shares
   * @param share is the number of vault shares to be burned
   */
<span class="fstat-no" title="function not covered" >  function withdraw(uint256 share) external nonReentrant notEmergency {</span>
<span class="cstat-no" title="statement not covered" >    uint256 withdrawAmount = _withdraw(share);</span>
<span class="cstat-no" title="statement not covered" >    IERC20(asset).safeTransfer(msg.sender, withdrawAmount)</span>;
  }
&nbsp;
  /**
   * @dev close out the previous round by calling "closePositions" on all actions
   */
<span class="fstat-no" title="function not covered" >  function closePositions() external onlyOwner unlocker {</span>
<span class="cstat-no" title="statement not covered" >    _closeAndWithdraw()</span>;
  }
&nbsp;
  /**
   * @dev distribute funds to each action
   */
<span class="fstat-no" title="function not covered" >  function rollOver(uint256[] calldata _allocationPercentages) external onlyOwner locker {</span>
<span class="cstat-no" title="statement not covered" >    require(_allocationPercentages.length == actions.length, 'INVALID_INPUT')</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >    emit Rollover(_allocationPercentages);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    _distribute(_allocationPercentages)</span>;
  }
&nbsp;
  /**
   * @dev set the percentage that should be reserved in vault for withdraw
   */
<span class="fstat-no" title="function not covered" >  function setWithdrawReserve(uint256 _reserve) external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >    withdrawReserve = _reserve</span>;
  }
&nbsp;
  /**
   * @dev set the state to "Emergency", which disable all withdraw and deposit
   */
<span class="fstat-no" title="function not covered" >  function emergencyPause() external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >    state = VaultState.Emergency</span>;
<span class="cstat-no" title="statement not covered" >    emit StateUpdated(VaultState.Emergency);</span>
  }
&nbsp;
  /**
   * @dev set the state from "Emergency", which disable all withdraw and deposit
   */
<span class="fstat-no" title="function not covered" >  function resumeFromPause(VaultState _newState) external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >    require(state == VaultState.Emergency, "!Emergency")</span>;
<span class="cstat-no" title="statement not covered" >    state = _newState</span>;
<span class="cstat-no" title="statement not covered" >    emit StateUpdated(_newState);</span>
  }
&nbsp;
  /*=====================
   * Internal functions *
   *====================*/
&nbsp;
  /**
   * total assets controlled by this vault
   */
<span class="fstat-no" title="function not covered" >  function _totalAsset() internal view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >    return _balance().add(_totalDebt());</span>
  }
&nbsp;
  /**
   * @dev returns remaining asset balance in the vault.
   */
<span class="fstat-no" title="function not covered" >  function _balance() internal view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >    return IERC20(asset).balanceOf(address(this));</span>
  }
&nbsp;
  /**
   * @dev iterate through all actions and sum up "values" controlled by the action.
   */
<span class="fstat-no" title="function not covered" >  function _totalDebt() internal view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >    uint256 debt = 0;</span>
<span class="cstat-no" title="statement not covered" >    for (uint8 i = 0; i &lt; actions.length; i++) {</span>
<span class="cstat-no" title="statement not covered" >      debt = debt.add(IAction(actions[i]).currentValue())</span>;
    }
<span class="cstat-no" title="statement not covered" >    return debt;</span>
  }
&nbsp;
  /**
   * @dev mint the shares to depositor, and emit the deposit event
   */
<span class="fstat-no" title="function not covered" >  function _deposit(uint256 _amount) internal {</span>
    // the asset is already deposited into the contract at this point, need to substract it from total
<span class="cstat-no" title="statement not covered" >    uint256 totalWithDepositedAmount = _totalAsset();</span>
<span class="cstat-no" title="statement not covered" >    require(totalWithDepositedAmount &lt; CAP, 'Cap exceeded')</span>;
<span class="cstat-no" title="statement not covered" >    uint256 totalBeforeDeposit = totalWithDepositedAmount.sub(_amount);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    uint256 share = _getSharesByDepositAmount(_amount, totalBeforeDeposit);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    emit Deposit(msg.sender, _amount, share);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    _mint(msg.sender, share)</span>;
  }
&nbsp;
  /**
   * @dev iterrate through each action, close position and withdraw funds
   */
<span class="fstat-no" title="function not covered" >  function _closeAndWithdraw() internal {</span>
<span class="cstat-no" title="statement not covered" >    address cacheAsset = asset;</span>
<span class="cstat-no" title="statement not covered" >    for (uint8 i = 0; i &lt; actions.length; i = i + 1) {</span>
      // 1. close position. this should revert if any position is not ready to be closed.
<span class="cstat-no" title="statement not covered" >      IAction(actions[i]).closePosition()</span>;
&nbsp;
      // 2. withdraw assets
<span class="cstat-no" title="statement not covered" >      uint256 actionBalance = IERC20(cacheAsset).balanceOf(actions[i]);</span>
<span class="cstat-no" title="statement not covered" >      if (actionBalance &gt; 0)</span>
<span class="cstat-no" title="statement not covered" >        IERC20(cacheAsset).safeTransferFrom(actions[i], address(this), actionBalance)</span>;
    }
  }
&nbsp;
  /**
   * @dev redistribute all funds to diff actions
   */
<span class="fstat-no" title="function not covered" >  function _distribute(uint256[] memory _percentages) internal nonReentrant {</span>
<span class="cstat-no" title="statement not covered" >    uint256 cacheTotalAsset = _totalAsset();</span>
<span class="cstat-no" title="statement not covered" >    uint256 cacheBase = BASE;</span>
&nbsp;
    // keep track of total percentage to make sure we're summing up to 100%
<span class="cstat-no" title="statement not covered" >    uint256 sumPercentage = withdrawReserve;</span>
<span class="cstat-no" title="statement not covered" >    address cacheAsset = asset;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    for (uint8 i = 0; i &lt; actions.length; i = i + 1) {</span>
<span class="cstat-no" title="statement not covered" >      sumPercentage = sumPercentage.add(_percentages[i])</span>;
<span class="cstat-no" title="statement not covered" >      require(sumPercentage &lt;= cacheBase, 'PERCENTAGE_SUM_EXCEED_MAX')</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >      uint256 newAmount = cacheTotalAsset.mul(_percentages[i]).div(cacheBase);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (newAmount &gt; 0) <span class="cstat-no" title="statement not covered" >IERC20(cacheAsset).safeTransfer(actions[i], newAmount)</span>;</span>
<span class="cstat-no" title="statement not covered" >      IAction(actions[i]).rolloverPosition()</span>;
    }
  }
&nbsp;
  /**
   * @dev burn shares, return withdraw amount handle by withdraw or withdrawETH
   * @param _share amount of shares burn to withdraw asset.
   */
<span class="fstat-no" title="function not covered" >  function _withdraw(uint256 _share) internal returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >    uint256 currentAssetBalance = _balance();</span>
<span class="cstat-no" title="statement not covered" >    uint256 withdrawAmount = _getWithdrawAmountByShares(_share);</span>
<span class="cstat-no" title="statement not covered" >    require(withdrawAmount &lt;= currentAssetBalance, 'NOT_ENOUGH_BALANCE')</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >    _burn(msg.sender, _share)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >    uint256 fee = _getWithdrawFee(withdrawAmount);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    IERC20(asset).transfer(feeRecipient, fee)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >    uint256 amountPostFee = withdrawAmount.sub(fee);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    emit Withdraw(msg.sender, amountPostFee, fee, _share);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    return amountPostFee;</span>
  }
&nbsp;
  /**
   * @dev return how many shares you can get if you deposit {_amount} asset
   * @param _amount amount of token depositing
   * @param _totalAssetAmount amont of asset already in the pool before deposit
   */
<span class="fstat-no" title="function not covered" >  function _getSharesByDepositAmount(uint256 _amount, uint256 _totalAssetAmount) internal view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >    uint256 shareSupply = totalSupply();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    uint256 shares = shareSupply == 0 ? _amount : _amount.mul(shareSupply).div(_totalAssetAmount);</span>
<span class="cstat-no" title="statement not covered" >    return shares;</span>
  }
&nbsp;
  /**
   * @dev return how many asset you can get if you burn the number of shares
   */
<span class="fstat-no" title="function not covered" >  function _getWithdrawAmountByShares(uint256 _share) internal view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >    uint256 totatlAsset = _totalAsset();</span>
<span class="cstat-no" title="statement not covered" >    uint256 shareSupply = totalSupply();</span>
<span class="cstat-no" title="statement not covered" >    uint256 withdrawAmount = _share.mul(totatlAsset).div(shareSupply);</span>
<span class="cstat-no" title="statement not covered" >    return withdrawAmount;</span>
  }
&nbsp;
  /**
   * @dev get amount of fee charged based on total amount of asset withdrawing.
   */
<span class="fstat-no" title="function not covered" >  function _getWithdrawFee(uint256 _withdrawAmount) internal pure returns (uint256) {</span>
    // todo: add fee model
    // currently fixed at 0.5% 
<span class="cstat-no" title="statement not covered" >    return _withdrawAmount.mul(50).div(BASE);</span>
  }
&nbsp;
  /**
    * @notice fallback function which disallows ETH to be sent to this contract without data except when unwrapping WETH
    */
<span class="fstat-no" title="function not covered" >  fallback() external payable {</span>
<span class="cstat-no" title="statement not covered" >    require(msg.sender == address(WETH), "Cannot receive ETH")</span>;
  }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu May 27 2021 13:14:35 GMT+0800 (Taipei Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
